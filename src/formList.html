<script src="../js/stu.js"></script>

<div id = "forms-list">
    <input class="w3-button w3-block w3-search-bar-grey w3-round-xlarge w3-large" style="margin-top: 20px; margin-left: auto; margin-right: auto; padding-left: 10px;" type="text" placeholder="Search...">

    <div class="w3-white w3-panel w3-leftbar w3-border-theme w3-round-xlarge">
        <div class="w3-left">
            <H3 class="w3-left">Registration Form</H3>
            <p></p>
            <p class="w3-left">Used for students to add or drop classes.</p>
        </div>
        <div class="w3-right">
            <!-- todo: make the on click call a a function -->
            <button class="w3-margin w3-theme-red w3-btn w3-round-xlarge" onclick="document.getElementById('id01').style.display='block'">Start Form</button>
        </div>
    </div>

    <div class="w3-white w3-panel w3-leftbar w3-border-theme w3-round-xlarge">
        <div class="w3-left">
            <H3 class="w3-left">Closed Class Form</H3>
            <p></p>
            <p class="w3-left">Used for students to get permission to enroll into a class that is full.</p>
        </div>
        <div class="w3-right">
            <button class="w3-margin w3-theme-red w3-btn w3-round-xlarge" onclick="homeApp.logOut()">Start Form</button>
        </div>
    </div>
</div>

<div id="id01" class="w3-modal" onload="startRegistrationFormProcess()">
    <div class="w3-modal-content w3-round-xlarge w3-border-theme w3-bottombar">
        <div class="w3-container">
            <span onclick="document.getElementById('id01').style.display='none'" class="w3-button w3-display-topright w3-round-xlarge w3-padding">&times;</span>
            <div class="w3-text-theme-red" style="display: block">
                <p></p>
                <H3 class="w3-left">Registration Form</H3>
                <h3 class="w3-right w3-padding-right">Due Date: 12/1/18</h3>
            </div>

            <div class="w3-container">
                <table id="classesTable" class="w3-table">
                    <tr>
                        <th>CRN</th>
                        <th>Prefix</th>
                        <th>Course No.</th>
                        <th>Sec.</th>
                        <th>Course Title</th>
                        <th>Audit</th>
                    </tr>
                    <!-- todo: somehow call addCourseRow, instead of repeating code for row-1-->
                    <tr id="row-1">
                        <td><input id="crn-1" class="w3-input" size="4" type="text"></td>
                        <td><input id="prefix-1" class="w3-input" size="4" type="text"></td>
                        <td><input id="course_no-1" class="w3-input" size="4" type="text"></td>
                        <td><input id="sec-1" class="w3-input" size="4" type="text"></td>
                        <td><input id="course_title-1" class="w3-input" size="20" type="text"></td>
                        <td id="audit-1" class="w3-center"><input class="w3-check" type="checkbox"></td>
                        <td class=><p class="w3-xlarge" style="margin-top: -3px" onclick="removeCourseRow('row-1')">x</p></td>
                    </tr>
                </table>
                <div class="w3-btn w3-theme-red w3-left w3-circle" onclick="addCourseRow()">+</div>
            </div>

            <br>
            <div>
                * A student may audit a course with the permission of his or her advisor and payment (if applicable) of an audit fee. An auditor does not receive a grade; an AU is recorded
                on the transcript in place of the grade if the auditor has, in general, maintained a satisfactory course attendance (usually 75 percent class attendance) and completed the
                appropriate assignments. If the student does not meet requirements, a final grade of F may be awarded. No changes in registration from credit to audit or from audit to credit
                will be permitted after the second week of classes.
            </div>
            <br>
            <div class="">
                <button class="w3-button w3-grey w3-round-xxlarge">Discard</button>
                <button class="w3-button w3-grey w3-round-xxlarge">Save</button>
                <!-- todo: submit should check if any fields are blank"-->
                <button id="submit_registration_form" class="w3-button w3-blue w3-round-xxlarge" onclick="submitForm()">Submit</button>
            </div>
            <br>
        </div>
    </div>
</div>

<script>
    class DesiredCourse {
        constructor(crn, prefix, course_no, sec, course_title, audit) {
            this.crn = crn;
            this.prefix = prefix;
            this.course_no = course_no;
            this.sec = sec;
            this.course_title = course_title;
            this.audit = audit;
        }
    }

    function submitForm (){
        var courses_list = [];

        $("#classesTable tr").each(function() {
            //nth row with course info.
            let row = this.id.split('-')[1];
            if (row > 0) {
                courses_list.push(
                    new DesiredCourse(
                    document.getElementById("crn-" + row).value,
                    document.getElementById("prefix-" + row).value,
                    document.getElementById("course_no-" + row).value,
                    document.getElementById("sec-" + row).value,
                    document.getElementById("course_title-" + row).value,
                    document.getElementById("audit-" + row).checked) //todo: figure out value for checkbox.
                )
                removeCourseRow(this.id, true);
            }
        });

        //saved the form data in courses_list, print to console to show its representation.
        console.log(courses_list);
        document.getElementById('id01').style.display='none'
    }

    //this is used to generate unique id's for the rows, so a user can delete a row.
    let courseUniqueID = 1;

    /*
    When the user selects the '+' to add an additional row, only if the row count is within 8.
    */
    function addCourseRow(){
        let num_rows = $('#classesTable tr').length-1;
        if (num_rows == 8) {
            alert("Only up to 8 courses are allowed to be added to this form!");
        } else {
            courseUniqueID++;

            $("#classesTable").append("                    <tr id=\"row-" + courseUniqueID + "\">\n" +
                "                        <td><input id=\"crn-" + courseUniqueID + "\" class=\"w3-input\" size=\"4\" type=\"text\"></td>\n" +
                "                        <td><input id=\"prefix-" + courseUniqueID + "\" class=\"w3-input\" size=\"4\" type=\"text\"></td>\n" +
                "                        <td><input id=\"course_no-" + courseUniqueID + "\" class=\"w3-input\" size=\"4\" type=\"text\"></td>\n" +
                "                        <td><input id=\"sec-" + courseUniqueID + "\" class=\"w3-input\" size=\"4\" type=\"text\"></td>\n" +
                "                        <td><input id=\"course_title-" + courseUniqueID + "\" class=\"w3-input\" size=\"20\" type=\"text\"></td>\n" +
                "                        <td id=\"audit-" + courseUniqueID + "\" class=\"w3-center\"><input class=\"w3-check\" type=\"checkbox\"></td>\n" +
                "                        <td class=><p class=\"w3-xlarge\" style=\"margin-top: -3px\" onclick=\"removeCourseRow('row-1')\">x</p></td>\n" +
                "                    </tr>");
        }
    }

    /*
    When the user selects the 'x' for a course row hide the row, only if the row count is more than 1.
     */
    function removeCourseRow(id, removeAll) {
        let num_rows = $('#classesTable tr').length-1;
        if (num_rows > 1 || removeAll) {
            document.getElementById(id).remove();
            //document.getElementById(id).style.display = 'none'
        } else {
            alert("At least one course must be present on this form");
        }
    }
</script>


<!---todo: API Call stuff
          <input class="w3-button w3-block w3-search-bar-grey w3-round-xlarge w3-large" style="margin-top: 20px; margin-left: auto; margin-right: auto; padding-left: 10px;" type="text" placeholder="Search to add a class...">

            <div class="w3-theme-red w3-panel w3-leftbar w3-border-theme w3-round-xlarge"><div id="class1" class="w3-left"></div>
                <span onclick="document.getElementById('class1').style.display='none'" class="w3-button w3-right w3-round-xlarge">&times;</span>
            </div>
            <div>
-->